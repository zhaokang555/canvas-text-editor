var D=Object.defineProperty;var S=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var m=(r,t,e)=>t in r?D(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,z=(r,t)=>{for(var e in t||(t={}))j.call(t,e)&&m(r,e,t[e]);if(S)for(var e of S(t))A.call(t,e)&&m(r,e,t[e]);return r};var h=(r,t,e)=>(m(r,typeof t!="symbol"?t+"":t,e),e);import{V as g,j as F,r as M,R as W,a as X}from"./vendor.4f28c16a.js";const _=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}};_();class I{constructor(t,e,s,o,i){h(this,"offsetY");h(this,"calcLayoutForChars",()=>{let t=this.left;this.chars.forEach(e=>{e.setPosition(t,this.top+this.offsetY),t+=e.width})});this.chars=t,this.width=e,this.height=s,this.left=o,this.top=i,this.offsetY=Math.max(...this.chars.map(n=>n.textMetrics.fontBoundingBoxAscent)),this.calcLayoutForChars(),this.chars.forEach((n,l)=>{n.prev=this.chars[l-1]||null})}}class N{constructor(t,e,s,o,i){h(this,"softLines",[]);h(this,"width",0);h(this,"height",0);h(this,"calcLayoutForSoftLines",()=>{let t=[],e=0,s=0,o=this.top;if(this.chars.forEach(i=>{if(t.length===0)t.push(i),e+=i.width,s=Math.max(s,i.height);else if(e+i.width<=this.maxWidth)t.push(i),e+=i.width,s=Math.max(s,i.height);else{const n=new I(t,e,s,this.left,o);this.softLines.push(n),o+=s,t=[i],e=i.width,s=i.height}}),t.length>0){const i=new I(t,e,s,this.left,o);this.softLines.push(i)}});h(this,"calcLayout",()=>{this.width=Math.max(...this.softLines.map(t=>t.width)),this.height=this.softLines.reduce((t,e)=>t+e.height,0)});h(this,"render",()=>{this.chars.forEach(t=>t.render())});this.chars=t,this.store=e,this.left=s,this.top=o,this.maxWidth=i,this.calcLayoutForSoftLines(),this.calcLayout()}destructor(){this.chars.forEach(t=>t.destructor())}}class k{constructor(t,e,s,o,i,n,l={}){h(this,"zIndex",0);h(this,"isMouseHovering",!1);h(this,"handleMouseMove",t=>{const e=this.store.ctx.canvas.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top;this.isMouseHovering=s>=this.left&&o>=this.top&&s<=this.left+this.width&&o<=this.top+this.height});this.left=t,this.top=e,this.width=s,this.height=o,this.cursorType=i,this.store=n,Object.entries(l).forEach(([c,u])=>this[c]=u),n.ctx.canvas.addEventListener("mousemove",this.handleMouseMove)}destructor(){this.store.ctx.canvas.removeEventListener("mousemove",this.handleMouseMove)}render(){this.isMouseHovering&&this.zIndex>=this.store.mouse.hover.topLayerZIndex&&(this.store.mouse.hover.topLayerZIndex=this.zIndex,this.store.mouse.hover.topLayerCursorType=this.cursorType)}}var v;(function(r){r.defaultCursor="default",r.ewResize="ew-resize",r.nsResize="ns-resize",r.neswResize="nesw-resize",r.nwseResize="nwse-resize",r.move="move",r.text="text"})(v||(v={}));var x=v;class y{constructor(t,e,s,o,i,n,l={}){h(this,"zIndex",0);h(this,"handleClick",t=>{const e=this.store.ctx.canvas.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top;s>=this.left&&o>=this.top&&s<=this.left+this.width&&o<=this.top+this.height&&(this.zIndex>this.store.mouse.click.topLayerZIndex?(this.store.mouse.click.topLayerCallbacks=[()=>this.onClick(s,o)],this.store.mouse.click.topLayerZIndex=this.zIndex):this.zIndex===this.store.mouse.click.topLayerZIndex&&this.store.mouse.click.topLayerCallbacks.push(()=>this.onClick(s,o)))});this.left=t,this.top=e,this.width=s,this.height=o,this.onClick=i,this.store=n,Object.entries(l).forEach(([c,u])=>this[c]=u),this.store.ctx.canvas.addEventListener("click",this.handleClick)}destructor(){this.store.ctx.canvas.removeEventListener("click",this.handleClick)}}const V="rgba(0, 0, 0, 0.15)";class G{constructor(t,e,s,o,i){h(this,"isSelected",!1);this.left=t,this.top=e,this.width=s,this.height=o,this.store=i}render(){this.isSelected&&(this.store.ctx.fillStyle=V,this.store.ctx.fillRect(this.left,this.top,this.width,this.height))}}class ${constructor(t,e,s,o,i,n){h(this,"handleMousedown",t=>{const e=this.store.ctx.canvas.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top;s>=this.left&&o>=this.top&&s<=this.left+this.width&&o<=this.top+this.height&&this.onMousedown()});this.left=t,this.top=e,this.width=s,this.height=o,this.onMousedown=i,this.store=n,this.store.ctx.canvas.addEventListener("mousedown",this.handleMousedown)}destructor(){this.store.ctx.canvas.removeEventListener("mousedown",this.handleMousedown)}}class q{constructor(t,e,s,o,i,n){h(this,"handleMouseup",t=>{const e=this.store.ctx.canvas.getBoundingClientRect(),s=t.clientX-e.left,o=t.clientY-e.top;s>=this.left&&o>=this.top&&s<=this.left+this.width&&o<=this.top+this.height&&this.onMouseup()});this.left=t,this.top=e,this.width=s,this.height=o,this.onMouseup=i,this.store=n,this.store.ctx.canvas.addEventListener("mouseup",this.handleMouseup)}destructor(){this.store.ctx.canvas.removeEventListener("mouseup",this.handleMouseup)}}class Z{constructor(t,e,s){h(this,"mousedownZone");h(this,"mouseupZone");this.clickableZone=t;const{left:o,top:i,width:n,height:l,store:c}=t;this.mousedownZone=new $(o,i,n,l,e,c),this.mouseupZone=new q(o,i,n,l,s,c)}setPosition(t,e){this.clickableZone.left=t,this.clickableZone.top=e,this.mousedownZone.left=t,this.mousedownZone.top=e,this.mouseupZone.left=t,this.mouseupZone.top=e}}const L=10;class a{constructor(t,e,s,o={}){h(this,"textMetrics");h(this,"top",0);h(this,"color","#000");h(this,"fontSize",50);h(this,"prev",null);h(this,"boundingBox");h(this,"leftHalf");h(this,"rightHalf");h(this,"selectableZone");h(this,"setPosition",(t,e)=>{this.top=e;const s=e-this.textMetrics.fontBoundingBoxAscent;this.boundingBox.left=t,this.boundingBox.top=s,this.leftHalf.setPosition(t,s),this.rightHalf.setPosition(t+this.width/2,s),this.selectableZone.left=t,this.selectableZone.top=s});h(this,"render",()=>{this.boundingBox.render(),this.selectableZone.render(),this.setStyle(),this.store.ctx.fillText(this.char,this.left,this.top)});h(this,"handleClickLeft",()=>{this.prev?(this.blinkingCursor.left=this.prev.rightHalf.clickableZone.left+this.prev.rightHalf.clickableZone.width,this.blinkingCursor.top=this.prev.rightHalf.clickableZone.top,this.blinkingCursor.height=this.prev.fontSize):(this.blinkingCursor.left=this.leftHalf.clickableZone.left,this.blinkingCursor.top=this.leftHalf.clickableZone.top,this.blinkingCursor.height=this.fontSize),this.blinkingCursor.afterClick()});h(this,"handleClickRight",()=>{this.blinkingCursor.left=this.rightHalf.clickableZone.left+this.rightHalf.clickableZone.width,this.blinkingCursor.top=this.rightHalf.clickableZone.top,this.blinkingCursor.height=this.fontSize,this.blinkingCursor.afterClick()});h(this,"handleMousedownLeft",()=>{this.store.clearSelect(),this.store.mouse.select.beginChar=this});h(this,"handleMousedownRight",()=>{this.store.clearSelect(),this.store.mouse.select.beginChar=this.store.getGlobalNextChar(this)});h(this,"handleMouseupLeft",()=>{this.store.mouse.select.endChar=this.store.getGlobalPrevChar(this),this.store.finishSelect()});h(this,"handleMouseupRight",()=>{this.store.mouse.select.endChar=this,this.store.finishSelect()});this.char=t,this.store=e,this.blinkingCursor=s,Object.entries(o).forEach(([l,c])=>this[l]=c),this.setStyle(),this.textMetrics=e.ctx.measureText(t);const i=this.textMetrics.width,n=this.textMetrics.fontBoundingBoxDescent+this.textMetrics.fontBoundingBoxAscent;this.boundingBox=new k(-1/0,-1/0,i,n,x.text,e,{zIndex:L}),this.leftHalf=new Z(new y(-1/0,-1/0,i/2,n,this.handleClickLeft,e,{zIndex:L}),this.handleMousedownLeft,this.handleMouseupLeft),this.rightHalf=new Z(new y(-1/0,-1/0,i/2,n,this.handleClickRight,e,{zIndex:L}),this.handleMousedownRight,this.handleMouseupRight),this.selectableZone=new G(-1/0,-1/0,i,n,e)}get left(){return this.boundingBox.left}get boundingBoxTop(){return this.boundingBox.top}get width(){return this.boundingBox.width}get height(){return this.boundingBox.height}destructor(){this.boundingBox.destructor(),this.leftHalf.clickableZone.destructor(),this.rightHalf.clickableZone.destructor()}setStyle(){this.store.ctx.fillStyle=this.color,this.store.ctx.font=`${this.fontSize}px sans-serif`}}const p=5,K=1e3;class d extends k{constructor(t,e,s,o,i={}){const n=t-p,l=e-p,c=2*p,u=2*p;super(n,l,c,u,s,o,z({zIndex:K},i));h(this,"borderColor","#999");h(this,"backgroundColor","#fff");h(this,"render",()=>{super.render(),this.store.ctx.beginPath(),this.store.ctx.setLineDash([]),this.store.ctx.arc(this.centerX,this.centerY,p,0,Math.PI*2),this.store.ctx.fillStyle=this.backgroundColor,this.store.ctx.fill(),this.store.ctx.strokeStyle=this.borderColor,this.store.ctx.stroke(),this.store.ctx.closePath()});this.centerX=t,this.centerY=e,this.cursorType=s}}const J="#999",Q=1,w=10,U=100;class b extends k{constructor(t,e,s){const o=e.clone().subtract(t).rotate(Math.PI/2).normalize(),i=[t.clone().add(o.clone().multiplyScalar(w/2)),t.clone().add(o.clone().multiplyScalar(-w/2)),e.clone().add(o.clone().multiplyScalar(w/2)),e.clone().add(o.clone().multiplyScalar(-w/2))],n=Math.min(...i.map(f=>f.x)),l=Math.min(...i.map(f=>f.y)),c=Math.max(...i.map(f=>f.x)),u=Math.max(...i.map(f=>f.y)),O=c-n,Y=u-l;super(n,l,O,Y,x.move,s,{zIndex:U});this.from=t,this.to=e}render(){super.render(),this.store.ctx.beginPath(),this.store.ctx.strokeStyle=J,this.store.ctx.lineWidth=Q,this.store.ctx.setLineDash([3]),this.store.ctx.moveTo(this.from.x,this.from.y),this.store.ctx.lineTo(this.to.x,this.to.y),this.store.ctx.stroke()}}const{round:B}=Math,E=1e3;class tt{constructor(t){h(this,"height",50);h(this,"startBlinkingTimestamp",0);h(this,"_left",-1/0);h(this,"_top",-1/0);h(this,"isShow",!1);this.store=t}get left(){return this._left}set left(t){this._left=B(t)}get top(){return this._top}set top(t){this._top=B(t)}show(){this.isShow=!0,this.startBlinkingTimestamp=Date.now()}hide(){this.isShow=!1}afterClick(){this.store.mouse.select.beginChar&&this.store.mouse.select.beginChar?this.hide():this.show()}render(){if(!this.isShow)return;(Date.now()-this.startBlinkingTimestamp)%E/E<.5&&(this.store.ctx.beginPath(),this.store.ctx.moveTo(this.left,this.top),this.store.ctx.lineTo(this.left,this.top+this.height),this.store.ctx.strokeStyle="#000",this.store.ctx.lineWidth=1,this.store.ctx.stroke())}}class et{constructor(t){h(this,"chars",[]);h(this,"mouse",{click:{topLayerZIndex:-1/0,topLayerCallbacks:[]},hover:{topLayerZIndex:-1/0,topLayerCursorType:x.defaultCursor},select:{beginChar:null,endChar:null}});this.ctx=t}getGlobalNextChar(t){const e=this.chars.indexOf(t);return this.chars[e+1]||null}getGlobalPrevChar(t){const e=this.chars.indexOf(t);return this.chars[e-1]||null}clearSelect(){this.mouse.select.beginChar=null,this.mouse.select.endChar=null}finishSelect(){const{beginChar:t,endChar:e}=this.mouse.select,s=this.chars.findIndex(i=>i===t),o=this.chars.findIndex(i=>i===e);s>-1&&o>-1?this.chars.forEach((i,n)=>{i.selectableZone.isSelected=n>=s&&n<=o}):this.chars.forEach(i=>i.selectableZone.isSelected=!1)}}const{defaultCursor:st,ewResize:R,nsResize:P,neswResize:T,nwseResize:H}=x;class it{constructor(t,e={}){h(this,"canvas");h(this,"store");h(this,"left",0);h(this,"top",0);h(this,"width",400);h(this,"height",300);h(this,"backgroundColor","#fff");h(this,"paddingLeft",10);h(this,"paragraphs",[]);h(this,"sizeControlPoints",[]);h(this,"borders",[]);h(this,"blinkingCursor");h(this,"blankSpace");h(this,"render",()=>{requestAnimationFrame(this.render),this.clearCanvas(),this.paragraphs.forEach(t=>t.render()),this.borders.forEach(t=>t.render()),this.sizeControlPoints.forEach(t=>t.render()),this.blinkingCursor.render(),this.canvas.style.cursor=this.store.mouse.hover.topLayerCursorType,this.store.mouse.click.topLayerCallbacks.forEach(t=>t()),this.store.mouse.click.topLayerCallbacks=[],this.store.mouse.click.topLayerZIndex=-1/0});h(this,"clearCanvas",()=>{this.store.ctx.fillStyle=this.backgroundColor,this.store.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.store.mouse.hover.topLayerZIndex=-1/0,this.store.mouse.hover.topLayerCursorType=st});h(this,"handleClickOnTheBlankSpace",(t,e)=>{let s=null,o=1/0;for(let l of this.paragraphs)for(let c of l.softLines){const u=e-c.top;(s==null||u>=0&&u<o)&&(s=c,o=u)}if(s==null)return;if(t<=s.chars[0].left){s.chars[0].handleClickLeft();return}let i=s.chars[0],n=t-i.left;for(let l of s.chars){const c=t-l.left;c>=0&&c<n&&(i=l,n=c)}n<=i.width/2?i.handleClickLeft():i.handleClickRight()});Object.entries(e).forEach(([o,i])=>this[o]=i),this.canvas=t;const s=this.canvas.getContext("2d");this.store=new et(s),this.blankSpace=new y(this.left,this.top,this.width,this.height,this.handleClickOnTheBlankSpace,this.store),this.blinkingCursor=new tt(this.store),this.initParagraphs(),this.initBorder(),this.initSizeControlPoints(),this.moveBlinkingCursorToEnd(),requestAnimationFrame(this.render)}destructor(){this.paragraphs.forEach(t=>t.destructor()),this.borders.forEach(t=>t.destructor()),this.sizeControlPoints.forEach(t=>t.destructor())}initParagraphs(){const t=[new a("/",this.store,this.blinkingCursor,{color:"red",fontSize:80}),new a("t",this.store,this.blinkingCursor,{color:"orange",fontSize:80}),new a("h",this.store,this.blinkingCursor,{color:"yellow",fontSize:80}),new a("o",this.store,this.blinkingCursor,{color:"green",fontSize:80}),new a("u",this.store,this.blinkingCursor,{color:"lightblue",fontSize:80}),new a("g",this.store,this.blinkingCursor,{color:"blue",fontSize:80}),new a("h",this.store,this.blinkingCursor,{color:"purple",fontSize:80}),new a("t",this.store,this.blinkingCursor,{color:"red",fontSize:80}),new a("w",this.store,this.blinkingCursor,{color:"orange",fontSize:80}),new a("o",this.store,this.blinkingCursor,{color:"yellow",fontSize:80}),new a("r",this.store,this.blinkingCursor,{color:"green",fontSize:80}),new a("k",this.store,this.blinkingCursor,{color:"lightblue",fontSize:80}),new a("s",this.store,this.blinkingCursor,{color:"blue",fontSize:80}),new a("\u601D",this.store,this.blinkingCursor,{color:"purple",fontSize:80}),new a("\u7279",this.store,this.blinkingCursor,{color:"red",fontSize:80}),new a("\u6C83",this.store,this.blinkingCursor,{color:"orange",fontSize:80}),new a("\u514B",this.store,this.blinkingCursor,{color:"yellow",fontSize:80})];this.paragraphs=[new N(t,this.store,this.left+this.paddingLeft,this.top,this.width-this.paddingLeft)],this.store.chars.push(...t)}initBorder(){const t=new g(this.left,this.top),e=new g(this.left+this.width,this.top),s=new g(this.left,this.top+this.height),o=new g(this.left+this.width,this.top+this.height);this.borders=[new b(t,e,this.store),new b(e,o,this.store),new b(o,s,this.store),new b(s,t,this.store)]}initSizeControlPoints(){this.sizeControlPoints=[new d(this.left,this.top,H,this.store),new d(this.left,this.top+this.height/2,R,this.store),new d(this.left,this.top+this.height,T,this.store),new d(this.left+this.width/2,this.top,P,this.store),new d(this.left+this.width/2,this.top+this.height,P,this.store),new d(this.left+this.width,this.top,T,this.store),new d(this.left+this.width,this.top+this.height/2,R,this.store),new d(this.left+this.width,this.top+this.height,H,this.store)]}moveBlinkingCursorToEnd(){const t=this.blinkingCursor;if(this.paragraphs.length>0){const e=this.paragraphs[this.paragraphs.length-1],s=e.chars[e.chars.length-1];t.left=s.left+s.width,t.top=s.boundingBoxTop,t.height=s.fontSize}else t.left=this.left+this.paddingLeft,t.top=this.top;t.show()}}const C=F.exports.jsx;function ot(){const r=M.exports.useRef(null);return M.exports.useEffect(()=>{r.current&&new it(r.current,{left:100,top:100})},[]),C("div",{children:C("canvas",{ref:r,width:"800",height:"600"})})}W.render(C(X.StrictMode,{children:C(ot,{})}),document.getElementById("root"));
